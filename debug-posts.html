<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🐛 Debug Posts Issue</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #0a0a0a;
            color: #fff;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .debug-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #1a1a1a;
            border-radius: 12px;
            border-left: 4px solid #ff2741;
        }
        .debug-section h3 {
            color: #ff2741;
            margin-top: 0;
        }
        .status {
            margin: 10px 0;
            padding: 10px;
            border-radius: 6px;
            font-size: 14px;
        }
        .success { background: rgba(34, 197, 94, 0.2); color: #22c55e; }
        .info { background: rgba(59, 130, 246, 0.2); color: #3b82f6; }
        .warning { background: rgba(245, 158, 11, 0.2); color: #f59e0b; }
        .error { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
        button {
            background: #ff2741;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        button:hover { background: #d71e36; }
        .test-result {
            margin: 10px 0;
            padding: 8px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
        }
        .app-frame {
            width: 100%;
            height: 500px;
            border: 2px solid #333;
            border-radius: 12px;
            background: #000;
            margin-top: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="debug-section">
            <h3>🐛 新帖子不显示问题调试</h3>
            <div class="status info">
                <strong>问题描述:</strong> 用户创建帖子后，帖子不在主页显示<br>
                <strong>修复状态:</strong> ✅ 已修复 PostsContext 数据结构问题
            </div>
        </div>

        <div class="debug-section">
            <h3>🔧 修复内容</h3>
            <div class="status success">
                <strong>✅ PostsContext修复:</strong><br>
                • 添加了 posts 字段（合并用户帖子+默认帖子）<br>
                • 添加了默认示例帖子数据<br>
                • 按时间排序显示帖子<br>
                • 修复了数据结构不匹配问题<br><br>
                
                <strong>✅ UploadForm修复:</strong><br>
                • 完善了帖子数据结构（添加 image, media, description 等字段）<br>
                • 统一了作者信息格式<br>
                • 添加了 likesCount, savesCount 字段<br><br>
                
                <strong>✅ ProfilePage修复:</strong><br>
                • 修复了变量名冲突问题<br>
                • 正确获取用户帖子数据
            </div>
        </div>

        <div class="debug-section">
            <h3>🧪 测试步骤</h3>
            <button onclick="testLocalStorage()">检查 localStorage</button>
            <button onclick="testPostStructure()">检查帖子结构</button>
            <button onclick="clearStorage()">清空存储</button>
            <button onclick="openApp()">打开应用</button>
            
            <div id="test-results"></div>
        </div>

        <div class="debug-section">
            <h3>📝 验证清单</h3>
            <div class="status warning">
                <strong>验证步骤:</strong><br>
                1. 打开应用，确认主页显示3个默认示例帖子<br>
                2. 登录账户（如果需要）<br>
                3. 进入 /upload 页面创建新帖子<br>
                4. 提交后应该跳转到主页<br>
                5. 新创建的帖子应该出现在列表顶部<br>
                6. 点击帖子卡片，确认模态框正常打开<br>
                7. 测试点赞/收藏功能<br>
                8. 进入 /profile 页面，在 Posts 标签下看到自己的帖子
            </div>
        </div>

        <div class="debug-section">
            <h3>🖥️ 应用预览</h3>
            <iframe id="app-frame" class="app-frame" src="http://localhost:5177/"></iframe>
        </div>
    </div>

    <script>
        function updateResults(content) {
            document.getElementById('test-results').innerHTML = content;
        }

        function testLocalStorage() {
            const results = [];
            
            // 检查 userPosts
            const userPosts = localStorage.getItem('userPosts');
            results.push(`<div class="test-result ${userPosts ? 'success' : 'warning'}">
                userPosts: ${userPosts ? JSON.parse(userPosts).length + ' 个帖子' : '无数据'}
            </div>`);
            
            // 检查 likedPosts
            const likedPosts = localStorage.getItem('likedPosts');
            results.push(`<div class="test-result ${likedPosts ? 'info' : 'warning'}">
                likedPosts: ${likedPosts ? JSON.parse(likedPosts).length + ' 个' : '无数据'}
            </div>`);
            
            // 检查 savedPosts
            const savedPosts = localStorage.getItem('savedPosts');
            results.push(`<div class="test-result ${savedPosts ? 'info' : 'warning'}">
                savedPosts: ${savedPosts ? JSON.parse(savedPosts).length + ' 个' : '无数据'}
            </div>`);
            
            updateResults(results.join(''));
        }

        function testPostStructure() {
            const userPosts = localStorage.getItem('userPosts');
            if (!userPosts) {
                updateResults('<div class="test-result warning">没有找到用户帖子数据</div>');
                return;
            }
            
            const posts = JSON.parse(userPosts);
            if (posts.length === 0) {
                updateResults('<div class="test-result warning">用户帖子列表为空</div>');
                return;
            }
            
            const lastPost = posts[0];
            const requiredFields = ['id', 'title', 'content', 'image', 'author', 'createdAt'];
            const missingFields = requiredFields.filter(field => !lastPost[field]);
            
            let result = `<div class="test-result success">
                最新帖子结构检查:<br>
                ID: ${lastPost.id}<br>
                标题: ${lastPost.title}<br>
                作者: ${lastPost.author?.name}<br>
                创建时间: ${lastPost.createdAt}
            </div>`;
            
            if (missingFields.length > 0) {
                result += `<div class="test-result error">
                    缺少字段: ${missingFields.join(', ')}
                </div>`;
            }
            
            updateResults(result);
        }

        function clearStorage() {
            localStorage.removeItem('userPosts');
            localStorage.removeItem('likedPosts');
            localStorage.removeItem('savedPosts');
            updateResults('<div class="test-result warning">已清空所有localStorage数据</div>');
        }

        function openApp() {
            document.getElementById('app-frame').src = 'http://localhost:5177/';
        }

        // 页面加载时自动检查
        window.onload = function() {
            testLocalStorage();
            console.log('🐛 Debug页面已加载');
            console.log('📝 检查localStorage和帖子结构');
        };
    </script>
</body>
</html>